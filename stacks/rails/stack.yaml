name: rails
extends: ruby
display_name: Ruby on Rails API
description: Backend API development with Ruby on Rails

compatible_with:
  - nextjs
  - nuxt
  - react-native
  - scraping

options:
  jobs:
    description: Background job processor
    default: sidekiq
    choices:
      sidekiq:
        description: Redis-backed job processor (most popular)
        patterns:
          - patterns/sidekiq.md
        variables:
          background_jobs: Sidekiq
          job_adapter: sidekiq
      good_job:
        description: Postgres-backed job processor (no Redis needed)
        patterns:
          - patterns/good_job.md
        variables:
          background_jobs: GoodJob
          job_adapter: good_job
      solid_queue:
        description: Database-backed job processor (Rails 8+)
        patterns:
          - patterns/solid_queue.md
        variables:
          background_jobs: SolidQueue
          job_adapter: solid_queue
      active_job:
        description: In-process jobs only (development)
        variables:
          background_jobs: ActiveJob (async)
          job_adapter: async

  serializer:
    description: JSON serializer library
    default: alba
    choices:
      alba:
        description: Fast, flexible serializer
        variables:
          serializer_library: Alba
      jsonapi:
        description: JSON:API compliant serializer
        variables:
          serializer_library: "JSONAPI::Serializer"
      blueprinter:
        description: Simple serializer with DSL
        variables:
          serializer_library: Blueprinter

agents:
  - name: backend-developer
    template: agents/backend-developer.md.j2
    description: Senior Rails developer for production code
    model: opus
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
    skills:
      - new-model
      - new-controller
      - new-service
      - new-migration
      - new-job
      - new-presenter

  - name: backend-tester
    template: agents/backend-tester.md.j2
    description: RSpec testing specialist
    model: sonnet
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
    skills:
      - new-spec
      - test

  - name: backend-reviewer
    template: agents/backend-reviewer.md.j2
    description: Rails code reviewer
    model: opus
    tools:
      - Read
      - Grep
      - Glob
      - Bash

skills:
  - new-model
  - new-controller
  - new-service
  - new-migration
  - new-job
  - new-presenter
  - new-spec
  - db-migrate
  - new-mailer
  - new-policy
  - new-concern
  - new-serializer

patterns:
  - patterns/backend-patterns.md
  - patterns/auth.md
  - patterns/pagination.md
  - patterns/oauth.md
  - patterns/file-upload.md
  - patterns/websocket.md
  - patterns/caching.md
  - patterns/logging.md
  - patterns/error-tracking.md
  - patterns/verification.md

variables:
  framework: Rails 7+
  language: Ruby
  test_framework: RSpec
  orm: ActiveRecord
  linter: RuboCop
  dev_port: 3000

verification:
  enabled: true
  auto_verify: true
  max_retries: 3
  dev_server:
    command: bundle exec rails server
    port: 3000
    health_check: /health
