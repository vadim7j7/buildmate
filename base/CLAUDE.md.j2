# Agent System Overview

This project uses a multi-agent architecture powered by Claude Code. A single
main agent orchestrates work by delegating to specialised sub-agents through
the **Task** tool. Sub-agents never spawn their own sub-agents; only the main
agent delegates.

**Configured stacks:** {{ stacks|map(attribute='display_name')|join(', ') }}

## Quick Start

Say **"Use PM: [task description]"** in any conversation to trigger the full
orchestration pipeline. The PM (project-manager) agent will break the task
down, create a feature file, and drive the pipeline to completion.

## Agent Pipeline

Every non-trivial task flows through the following stages:

```
Plan --> Implement --> Test --> Review --> (Eval --> Security --> Docs)
```

| Stage      | Agent                    | Purpose                                    |
|------------|--------------------------|-------------------------------------------|
| Plan       | PM (orchestrator)        | Break task into sub-tasks, create feature |
| Implement  | *-developer              | Write production code                     |
| Test       | *-tester                 | Write and run tests                       |
| Review     | *-reviewer               | Code review, find issues                  |
| Grind      | grind                    | Fix-verify loops until quality gates pass |
| Eval       | eval-agent               | Score against quality rubrics             |
| Security   | security-auditor         | OWASP scan, vulnerability check           |

Stages in parentheses are optional and run when explicitly requested.

## Available Agents

| Agent | Description | Model |
|-------|-------------|-------|
{% for agent in all_agents %}
| `{{ agent.name }}` | {{ agent.description }} | {{ agent.model }} |
{% endfor %}

## Quality Gates

Before the review stage, the following gates **must** pass:

{% for stack in stacks %}
### {{ stack.display_name }}
{% if stack.working_dir != "." %}
**Working directory:** `{{ stack.working_dir }}`
{% endif %}

| Gate | Command | Requirement |
|------|---------|-------------|
{% for gate_name, gate in stack.quality_gates.items() %}
| {{ gate_name | title }} | `{{ gate.command }}` | Zero errors |
{% endfor %}

{% endfor %}

If any gate fails, the **grind agent** runs fix-verify loops until all gates
pass or max iterations are reached.

## Available Slash Commands

### Core Commands

| Command | Description |
|---------|-------------|
| `/pm` | Run the full PM orchestration pipeline |
| `/delegate` | Smart task delegation (auto-picks parallel/sequential) |
| `/parallel` | Run multiple tasks in parallel via git worktrees |
| `/sequential` | Run tasks through the pipeline in order |
| `/recap` | Load saved context and show status summary |
| `/eval` | Run quality evaluation |
| `/security` | Run security audit |

### Stack Commands
{% for stack in stacks %}

#### {{ stack.display_name }}

| Command | Description |
|---------|-------------|
{% for skill in stack.skills %}
| `/{{ skill }}` | {{ skill | replace('-', ' ') | title }} |
{% endfor %}
{% endfor %}

## Feature Tracking

Features are tracked as markdown files in `.claude/context/features/`.

```bash
# Convention: YYYYMMDD-short-slug.md
touch .claude/context/features/$(date +%Y%m%d)-my-feature.md
```

## Session Memory

The agent system includes automatic session persistence:

- **After each response:** Context is saved to `.claude/context/active-work.md`
- **On session start:** Previous context is loaded automatically
- **Use `/recap`:** For detailed status check at any time

## Delegation Rules

1. **Only the main agent delegates.** Sub-agents execute and return results.
2. **One responsibility per agent.** Each sub-agent owns a single concern.
3. **Context flows forward.** Each stage writes to `.agent-pipeline/<stage>.md`.
4. **Failures stop the pipeline.** The main agent reports actionable details.

---

*Generated by [Buildmate](https://github.com/vadim7j7/buildmate)*
